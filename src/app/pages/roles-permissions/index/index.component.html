<app-header></app-header>
<div class="container-fluid">
    <div class="row">
        <app-sidebar></app-sidebar>
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
            <div
                class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2 fst-italic fw-bold text-primary">Settings - Roles and Permissions</h1>
            </div>
            <div class="container">
                <div class="card">
                    <div class="card-body">
                        <div class="mb-3">
                            <div class="d-flex justify-content-between">
                                <div class="form-group">
                                    <label for="idRole" class="form-label">Role</label>
                                    <select id="idRole" class="form-select" (change)="changeRole($event)">
                                        <option [value]="role._id" *ngFor="let role of roles">{{role.name}}</option>
                                    </select>
                                </div>
                                <div class="btn-tolbar">
                                    <button class="btn btn-primary me-1"  type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasRight1" aria-controls="offcanvasRight1">Add New Role</button>
                                    <button class="btn btn-primary"  type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasRight2" aria-controls="offcanvasRight2" >Add New Permission</button>
                                </div>
                            </div>
                        </div>
                        <h5 class="card-tittle">Permissions to Role: {{role}}</h5>
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th scope="col">Permission</th>
                                        <th scope="col"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <ng-container *ngIf="permissions.length > 0">
                                        <tr *ngFor="let permission of permissions">
                                            <td><label class="form-check-label" for="{{permission._id}}">{{permission.url}}</label></td>
                                            <td>
                                                <div class="form-check form-check-inline">
                                                    <input class="form-check-input" type="checkbox"
                                                        id="{{permission._id}}" [checked]="findPermissionRole(permission._id) == true" >
                                                </div>
                                            </td>
                                        </tr>
                                    </ng-container>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="row justify-content-center position-absolute top-0 bottom-0 start-0 end-0 mx-auto bg-white" *ngIf="loading" >
                        <div class="col text-center">
                            <span class="spinner-border spinner-border text-success" style="width: 10rem; height: 10rem;" role="status" aria-hidden="true"></span>
                            <p class="text-muted" style="font-size: 18px;">Por favor espere, estamos procesando su petici√≥n ...</p> 
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

<div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasRight1" aria-labelledby="offcanvasRightLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="offcanvasRightLabel">Add New Role</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
        <form >
            <div class="mb-3">
                <label for="name" class="form-label">Name role</label>
                <input type="text" class="form-control" id="name">
            </div>
            <div class="d-grid gap-2 col-7 mx-auto">
                <button class="btn btn-primary" type="submit">Submit</button>
                <button class="btn btn-light"  type="button">Cancel</button>
            </div>
        </form>
      <div class="table-responsive">
        <table class="table">
            <thead>
                <tr>
                    <th>Name</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let role of roles">
                    <td>{{role.name}}</td>
                </tr>
            </tbody>
        </table>
      </div>
    </div>
</div>

<div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasRight2" aria-labelledby="offcanvasRightLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="offcanvasRightLabel">Add New Permission</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
        <form >
            <div class="mb-3">
                <label for="url" class="form-label">Url</label>
                <input type="text" class="form-control" id="url">
            </div>
            <div class="mb-3">
                <label for="method" class="form-label">Metho</label>
                <input type="text" class="form-control" id="method">
            </div>
            <div class="d-grid gap-2 col-7 mx-auto">
                <button class="btn btn-primary" type="submit">Submit</button>
                <button class="btn btn-light"  type="button">Cancel</button>
            </div>
        </form>
      <div class="table-responsive">
        <table class="table">
            <thead>
                <tr>
                    <th>Url</th>
                    <th>Method</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let permission of permissions" >
                    <td>{{permission.url}}</td>
                    <td>{{permission.method}}</td>
                </tr>
            </tbody>
        </table>
      </div>
    </div>
</div>

